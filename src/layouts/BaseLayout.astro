---
import Header from '@/components/core/Header';
import Analytics from '@vercel/analytics/astro';
import { ViewTransitions } from 'astro:transitions';
import '../styles/global.css';
import { getRelativeLocaleUrl } from 'astro:i18n';

export interface Props {
  title?: string;
  description?: string;
}
const {
  title = 'Alejandro Mira — GenAI & AI Engineer',
  description = 'Porfolio de proyectos, artículos y charlas sobre IA generativa y agentes LLM.',
} = Astro.props;

// Detectar el idioma actual de la URL
const currentLang = Astro.currentLocale || 'es';

// Obtener la ruta sin el prefijo de idioma para generar alternativas
const currentPath = Astro.url.pathname;
let pathWithoutLang = currentPath;

// Eliminar el prefijo /es o /en
if (currentPath.startsWith('/en/')) {
  pathWithoutLang = currentPath.substring(3);
} else if (currentPath.startsWith('/es/')) {
  pathWithoutLang = currentPath.substring(3);
}

// Asegurar que pathWithoutLang siempre comience con /
if (!pathWithoutLang.startsWith('/')) {
  pathWithoutLang = '/' + pathWithoutLang;
}

// Generar URLs completas para hreflang
const esUrl = new URL(getRelativeLocaleUrl('es', pathWithoutLang), Astro.site);
const enUrl = new URL(getRelativeLocaleUrl('en', pathWithoutLang), Astro.site);
const canonicalUrl = currentLang === 'es' ? esUrl : enUrl;
---

<html lang={currentLang}>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{title}</title>
    <meta name="description" content={description} />
    <link rel="canonical" href={canonicalUrl} />

    <!-- Etiquetas hreflang para SEO multiidioma -->
    <link rel="alternate" hreflang="es" href={esUrl} />
    <link rel="alternate" hreflang="en" href={enUrl} />
    <link rel="alternate" hreflang="x-default" href={esUrl} />

    <!-- Open Graph -->
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:url" content={canonicalUrl} />
    <meta property="og:locale" content={currentLang === 'es' ? 'es_ES' : 'en_US'} />
    <meta property="og:locale:alternate" content={currentLang === 'es' ? 'en_US' : 'es_ES'} />
    <ViewTransitions />
  </head>
  <body class="min-h-screen bg-background text-foreground" transition:animate="fade">
    <Header client:load currentLocale={currentLang} currentPath={currentPath} transition:persist />
    <slot />
    <Analytics />
  </body>
</html>
