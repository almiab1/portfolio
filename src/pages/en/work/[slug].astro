---
import Layout from "@/layouts/BaseLayout.astro";
import { ldCreativeWork } from "@/lib/schema";
import { getProjectsByLang } from "@/lib/i18n-content";
import { useTranslations } from "@/i18n/utils";
import { ExternalLink, Github, ChevronLeft } from "lucide-react";

export async function getStaticPaths() {
  const projects = await getProjectsByLang('en');
  return projects.map((project) => ({
    // Extraer slug base sin el prefijo de idioma (en/cookobot -> cookobot)
    params: { slug: project.slug.replace(/^(es|en)\//, '') },
    props: { project },
  }));
}

const { project } = Astro.props;
const { Content } = await project.render();
const data = project.data;
const t = useTranslations("en");
---

<Layout title={`${data.title} â€” ${t('work.caseStudy')}`} description={data.summary}>
  <script type="application/ld+json">{JSON.stringify(ldCreativeWork({ title: data.title, date: data.date }))}</script>
  
  <article class="mx-auto max-w-4xl px-6 py-12">
    <!-- Back Button -->
    <a 
      href="/en/work" 
      class="text-primary hover:text-primary/80 mb-8 inline-flex items-center gap-2 text-sm font-medium transition-colors"
      aria-label={t('work.backToProjects')}
    >
      <ChevronLeft size={16} />
      {t('work.backToProjects')}
    </a>

    <!-- Header -->
    <header class="mb-12">
      <h1 class="text-foreground mb-4 text-4xl font-bold md:text-5xl">
        {data.title}
      </h1>
      <p class="text-muted-foreground mb-6 text-xl leading-relaxed">
        {data.summary}
      </p>

      <!-- Metadata Grid -->
      <div class="border-border bg-card grid gap-6 rounded-xl border p-6 md:grid-cols-2">
        {data.role && (
          <div>
            <h3 class="text-muted-foreground mb-2 text-sm font-medium uppercase">
              {t('project.role')}
            </h3>
            <p class="text-foreground font-medium">{data.role}</p>
          </div>
        )}

        {data.tags && data.tags.length > 0 && (
          <div>
            <h3 class="text-muted-foreground mb-2 text-sm font-medium uppercase">
              {t('project.tags')}
            </h3>
            <div class="flex flex-wrap gap-2">
              {data.tags.map((tag) => (
                <span class="bg-primary/10 text-primary rounded-full px-3 py-1 text-xs font-medium">
                  {tag}
                </span>
              ))}
            </div>
          </div>
        )}

        {data.tech && data.tech.length > 0 && (
          <div class="md:col-span-2">
            <h3 class="text-muted-foreground mb-2 text-sm font-medium uppercase">
              {t('project.tech')}
            </h3>
            <div class="flex flex-wrap gap-2">
              {data.tech.map((tech) => (
                <span class="border-border bg-background rounded-lg border px-3 py-1 text-sm font-medium">
                  {tech}
                </span>
              ))}
            </div>
          </div>
        )}

        {(data.links?.demo || data.links?.repo) && (
          <div class="md:col-span-2">
            <h3 class="text-muted-foreground mb-3 text-sm font-medium uppercase">
              {t('project.links')}
            </h3>
            <div class="flex flex-wrap gap-3">
              {data.links.demo && (
                <a
                  href={data.links.demo}
                  target="_blank"
                  rel="noopener noreferrer"
                  class="bg-primary text-primary-foreground hover:bg-primary/90 inline-flex items-center gap-2 rounded-lg px-4 py-2 text-sm font-medium transition-colors"
                >
                  <ExternalLink size={16} />
                  {t('project.demo')}
                </a>
              )}
              {data.links.repo && (
                <a
                  href={data.links.repo}
                  target="_blank"
                  rel="noopener noreferrer"
                  class="border-border bg-background hover:bg-accent inline-flex items-center gap-2 rounded-lg border px-4 py-2 text-sm font-medium transition-colors"
                >
                  <Github size={16} />
                  {t('project.repo')}
                </a>
              )}
            </div>
          </div>
        )}
      </div>
    </header>

    <!-- Content -->
    <div class="prose dark:prose-invert prose-lg mx-auto">
      <Content />
    </div>
  </article>
</Layout>
