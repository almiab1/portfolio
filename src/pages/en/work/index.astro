---
import Layout from "@/layouts/BaseLayout.astro";
import { getProjectsByLang } from "@/lib/i18n-content";
import { useTranslations } from "@/i18n/utils";
import ProjectCard from "@/components/blocks/ProjectCard.astro";

const projects = await getProjectsByLang("en");
const t = useTranslations("en");

// Ordenar proyectos: destacados primero, luego por priority, luego por fecha
const sortedProjects = projects.sort((a, b) => {
  // Destacados primero
  if (a.data.featured && !b.data.featured) return -1;
  if (!a.data.featured && b.data.featured) return 1;

  // Luego por prioridad
  const priorityA = a.data.priority ?? 5;
  const priorityB = b.data.priority ?? 5;
  if (priorityA !== priorityB) return priorityB - priorityA;

  // Finalmente por fecha
  return new Date(b.data.date).getTime() - new Date(a.data.date).getTime();
});

// Estadísticas
const stats = {
  total: sortedProjects.length,
  featured: sortedProjects.filter((p) => p.data.featured).length,
  types: [...new Set(sortedProjects.map((p) => p.data.type))].length,
};
---

<Layout title={t("work.title")} description={t("hero.description")}>
  <main class="mx-auto max-w-7xl px-6 py-12">
    <!-- Header con estadísticas -->
    <div class="mb-12">
      <div class="mb-6">
        <h1 class="text-foreground mb-4 text-4xl font-bold md:text-5xl">
          {t("nav.work")}
        </h1>
        <p class="text-muted-foreground max-w-2xl text-lg">
          {t("hero.description")}
        </p>
      </div>

      <!-- Estadísticas -->
      <div class="grid gap-4 sm:grid-cols-3">
        <div class="border-border bg-card rounded-lg border p-4">
          <p class="text-muted-foreground text-sm">Total projects</p>
          <p class="text-foreground text-2xl font-bold">{stats.total}</p>
        </div>
        <div class="border-border bg-card rounded-lg border p-4">
          <p class="text-muted-foreground text-sm">Featured projects</p>
          <p class="text-foreground text-2xl font-bold">{stats.featured}</p>
        </div>
        <div class="border-border bg-card rounded-lg border p-4">
          <p class="text-muted-foreground text-sm">Project types</p>
          <p class="text-foreground text-2xl font-bold">{stats.types}</p>
        </div>
      </div>
    </div>

    <!-- Projects Grid -->
    {
      sortedProjects.length > 0 ? (
        <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
          {sortedProjects.map((project) => (
            <ProjectCard project={project} currentLang="en" />
          ))}
        </div>
      ) : (
        <p class="text-muted-foreground py-12 text-center">
          {t("work.noProjects")}
        </p>
      )
    }
  </main>
</Layout>
